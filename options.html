<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOSS直聘助手 - 设置</title>
  <link rel="stylesheet" href="options.css">
  <!-- PDF.js库 - 本地版本，用于解析PDF文件 -->
  <script src="lib/pdf.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>设置</h1>
      <p class="subtitle">配置AI服务以获得更智能的匹配分析</p>

      <div>
        <!-- API Key -->
        <div class="form-section">
          <label class="form-label">
            API Key
            <span class="form-hint">
              你的AI API密钥（支持OpenAI、Kimi、Claude等OpenAI兼容格式）
            </span>
          </label>
          <input 
            type="password" 
            id="apiKey" 
            placeholder="请输入你的API Key"
            class="form-control"
          >
          <button 
            type="button" 
            id="toggleApiKey"
            class="toggle-btn"
          >
            显示/隐藏
          </button>
        </div>

        <!-- Base URL -->
        <div class="form-section">
          <label class="form-label">
            BaseUrl
            <span class="form-hint">
              API端点地址（例如：https://api.openai.com/v1 或 https://api.moonshot.cn/v1）
            </span>
          </label>
          <input 
            type="text" 
            id="baseUrl" 
            placeholder="例如: https://api.openai.com/v1"
            class="form-control"
          >
        </div>

        <!-- 模型选择 -->
        <div class="form-section">
          <label class="form-label">
            模型名称
            <span class="form-hint">
              填写模型名称（例如：gpt-5.1-all、claude-4-sonnet等）
            </span>
          </label>
          <input 
            type="text" 
            id="aiModel" 
            placeholder="例如: gpt-3.5-turbo"
            class="form-control"
          >
        </div>

        <!-- AI配置操作按钮 -->
        <div class="button-group">
          <button id="saveBtn" class="btn btn-primary">保存设置</button>
          <button id="testBtn" class="btn btn-secondary">测试连接</button>
        </div>

        <!-- 状态消息 -->
        <div id="statusMessage" class="status-message hidden"></div>
      </div>

      <!-- 简历管理 -->
      <div class="divider">
        <div class="section-header">
          <div>
            <h2 class="section-title">简历管理</h2>
            <p class="subtitle" style="margin-bottom: 0;">支持多份简历，最多5份</p>
          </div>
          <button id="addResumeBtn" class="btn-add-resume">+ 添加简历</button>
        </div>

        <div class="form-section">
          <!-- 上传进度条 -->
          <div id="uploadProgress" class="upload-progress hidden">
            <div class="progress-header">
              <span id="progressText">正在上传...</span>
              <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar-container">
              <div id="progressBar" class="progress-bar" style="width: 0%"></div>
            </div>
          </div>
          
          <div id="resumeList" class="resume-list"></div>
          <div id="noResumes" class="empty-state hidden">
            <p>暂无简历</p>
          </div>
          <input type="file" id="resumeFileInput" class="hidden" accept=".pdf,.doc,.docx,.txt">
          
          <!-- 简历预览区域 -->
          <div id="resumePreview" class="resume-preview hidden">
            <div class="preview-header">
              <h3>简历内容预览</h3>
              <button id="closePreview" class="btn-close">×</button>
            </div>
            <div class="preview-info">
              <span id="previewFileName">文件名</span>
              <span id="previewFileSize">大小</span>
              <span id="previewContentLength">长度</span>
            </div>
            <div class="preview-content" id="previewContent">
              <!-- 简历内容 -->
            </div>
            <div class="preview-actions">
              <button id="togglePreviewBtn" class="btn-secondary">展开全部</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 使用统计 -->
      <div class="divider">
        <h2 class="section-title">使用统计</h2>
        <p class="subtitle">查看分析数据和使用情况</p>
        
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value" id="totalAnalysis">0</div>
            <div class="stat-label">总分析次数</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="averageScore">0</div>
            <div class="stat-label">平均匹配度</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="highestScore">-</div>
            <div class="stat-label">最高匹配岗位</div>
            <div class="stat-detail" id="highestDetail"></div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="lowestScore">-</div>
            <div class="stat-label">最低匹配岗位</div>
            <div class="stat-detail" id="lowestDetail"></div>
          </div>
        </div>
        
        <!-- 分数分布 -->
        <div class="distribution-section">
          <h3>匹配度分布</h3>
          <div class="distribution-item">
            <span class="distribution-label">高匹配 (≥75分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar high" id="highBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="highCount">0</span>
          </div>
          <div class="distribution-item">
            <span class="distribution-label">中匹配 (60-74分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar medium" id="mediumBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="mediumCount">0</span>
          </div>
          <div class="distribution-item">
            <span class="distribution-label">低匹配 (<60分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar low" id="lowBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="lowCount">0</span>
          </div>
        </div>
      </div>

      <!-- 历史记录 -->
      <div class="divider">
        <div class="section-header">
          <h2 class="section-title">分析历史</h2>
          <a id="clearHistoryBtn" class="link-quiet">清空</a>
        </div>
        <p class="subtitle">查看所有匹配分析记录</p>
        
        <div id="historyLoading" class="loading-state hidden">
          <p>加载中...</p>
        </div>
        
        <div id="historyList" class="history-container"></div>
        
        <div id="noHistory" class="empty-state hidden">
          <p>暂无分析历史</p>
        </div>
      </div>


      <!-- 隐私说明 -->
      <div class="privacy-box">
        <h3>隐私声明</h3>
        <p>
          你的API Key和所有配置信息仅存储在本地浏览器中，不会上传到任何服务器。
          简历内容仅在分析时通过API发送给你选择的AI服务提供商。
        </p>
      </div>
    </div>
  </div>

  <script src="error-handler.js"></script>
  <script src="file-parser.js"></script>
  <script src="history-utils.js"></script>
  <script src="stats-manager.js"></script>
  <script src="options.js"></script>
</body>
</html>
