<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOSS直聘助手 - 设置</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>设置</h1>
      <p class="subtitle">配置AI服务以获得更智能的匹配分析</p>

      <div>
        <!-- AI服务商选择 -->
        <div class="form-section">
          <label class="form-label">
            AI服务提供商
          </label>
          <select id="aiProvider" class="form-control">
            <option value="none">不使用AI（使用本地算法）</option>
            <option value="kimi">Kimi (Moonshot AI) - 推荐用于文件解析</option>
            <option value="openai">OpenAI GPT</option>
            <option value="claude">Anthropic Claude</option>
            <option value="zhipu">智谱AI (GLM)</option>
            <option value="qwen">通义千问</option>
          </select>
        </div>

        <!-- API Key -->
        <div id="apiKeySection" class="form-section hidden">
          <label class="form-label">
            API Key
            <span class="form-hint">
              你的API密钥将安全存储在本地
            </span>
          </label>
          <input 
            type="password" 
            id="apiKey" 
            placeholder="请输入你的API Key"
            class="form-control"
          >
          <button 
            type="button" 
            id="toggleApiKey"
            class="toggle-btn"
          >
            显示/隐藏
          </button>
        </div>

        <!-- Base URL (可选) -->
        <div id="baseUrlSection" class="form-section hidden">
          <label class="form-label">
            BaseURL (可选)
            <span class="form-hint">
              自定义API端点，如使用代理
            </span>
          </label>
          <input 
            type="text" 
            id="baseUrl" 
            placeholder="例如: https://api.openai.com/v1"
            class="form-control"
          >
        </div>

        <!-- 模型选择 -->
        <div id="modelSection" class="form-section hidden">
          <label class="form-label">
            模型
            <span class="form-hint">
              可从列表选择或自定义输入
            </span>
          </label>
          <input 
            type="text" 
            id="aiModel" 
            list="modelList"
            placeholder="留空使用默认模型，或输入自定义模型名称"
            class="form-control"
          >
          <datalist id="modelList">
            <!-- 模型选项将由JS动态填充 -->
          </datalist>
        </div>

        <!-- 提示信息 -->
        <div id="providerInfo" class="info-box hidden">
          <h3>获取API Key</h3>
          <p id="providerInfoText"></p>
        </div>

        <!-- AI配置操作按钮 -->
        <div class="button-group">
          <button id="saveBtn" class="btn btn-primary">保存设置</button>
          <button id="testBtn" class="btn btn-secondary">测试连接</button>
        </div>

        <!-- 状态消息 -->
        <div id="statusMessage" class="status-message hidden"></div>
      </div>

      <!-- 简历管理 -->
      <div class="divider">
        <div class="section-header">
          <div>
            <h2 class="section-title">简历管理</h2>
            <p class="subtitle" style="margin-bottom: 0;">支持多份简历，最多5份</p>
          </div>
          <button id="addResumeBtn" class="btn-add-resume">+ 添加简历</button>
        </div>

        <div class="form-section">
          <div id="resumeList" class="resume-list"></div>
          <div id="noResumes" class="empty-state hidden">
            <p>暂无简历</p>
          </div>
          <input type="file" id="resumeFileInput" class="hidden" accept=".pdf,.doc,.docx,.txt">
        </div>
      </div>

      <!-- 使用统计 -->
      <div class="divider">
        <h2 class="section-title">使用统计</h2>
        <p class="subtitle">查看分析数据和使用情况</p>
        
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value" id="totalAnalysis">0</div>
            <div class="stat-label">总分析次数</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="averageScore">0</div>
            <div class="stat-label">平均匹配度</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="highestScore">-</div>
            <div class="stat-label">最高匹配岗位</div>
            <div class="stat-detail" id="highestDetail"></div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="lowestScore">-</div>
            <div class="stat-label">最低匹配岗位</div>
            <div class="stat-detail" id="lowestDetail"></div>
          </div>
        </div>
        
        <!-- 分数分布 -->
        <div class="distribution-section">
          <h3>匹配度分布</h3>
          <div class="distribution-item">
            <span class="distribution-label">高匹配 (≥75分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar high" id="highBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="highCount">0</span>
          </div>
          <div class="distribution-item">
            <span class="distribution-label">中匹配 (60-74分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar medium" id="mediumBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="mediumCount">0</span>
          </div>
          <div class="distribution-item">
            <span class="distribution-label">低匹配 (<60分)</span>
            <div class="distribution-bar-wrap">
              <div class="distribution-bar low" id="lowBar" style="width: 0%"></div>
            </div>
            <span class="distribution-count" id="lowCount">0</span>
          </div>
        </div>
      </div>

      <!-- 历史记录 -->
      <div class="divider">
        <div class="section-header">
          <h2 class="section-title">分析历史</h2>
          <a id="clearHistoryBtn" class="link-quiet">清空</a>
        </div>
        <p class="subtitle">查看所有匹配分析记录</p>
        
        <div id="historyLoading" class="loading-state hidden">
          <p>加载中...</p>
        </div>
        
        <div id="historyList" class="history-container"></div>
        
        <div id="noHistory" class="empty-state hidden">
          <p>暂无分析历史</p>
        </div>
      </div>

      <!-- 使用说明 -->
      <div class="divider">
        <h2 class="section-title">使用说明</h2>
        <div class="prose">
          <ul>
            <li>选择你偏好的AI服务提供商</li>
            <li>输入对应的API Key（需要自行申请）</li>
            <li>模型名称可从下拉列表选择，也可以自定义输入（支持新模型或自定义模型）</li>
            <li>Base URL可自定义，用于使用代理或自建服务</li>
            <li>点击"测试连接"验证配置是否正确</li>
            <li>保存设置后即可在插件中使用AI功能</li>
            <li>如不配置AI服务，插件将使用本地算法进行匹配分析</li>
          </ul>
        </div>
      </div>

      <!-- 隐私说明 -->
      <div class="privacy-box">
        <h3>隐私声明</h3>
        <p>
          你的API Key和所有配置信息仅存储在本地浏览器中，不会上传到任何服务器。
          简历内容仅在分析时通过API发送给你选择的AI服务提供商。
        </p>
      </div>
    </div>
  </div>

  <script src="file-parser.js"></script>
  <script src="history-utils.js"></script>
  <script src="stats-manager.js"></script>
  <script src="options.js"></script>
</body>
</html>
